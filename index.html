<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Centered Button Page</title>

    <!-- Tailwind CSS v4 (via CDN) -->
    <script src="https://cdn.tailwindcss.com?plugins=forms,typography,aspect-ratio,line-clamp"></script>

    <!-- Flowbite CSS -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/flowbite/2.3.0/flowbite.min.css" rel="stylesheet"/>
</head>
<body class="min-h-screen bg-gray-100 flex items-center justify-center p-4">

<!-- Centered Button -->
<button
        id="print-document"
        type="button"
        class="text-white bg-blue-700 hover:bg-blue-800 focus:ring-4 focus:ring-blue-300 font-medium rounded-lg text-lg px-6 py-3 text-center dark:bg-blue-600 dark:hover:bg-blue-700 dark:focus:ring-blue-800 transition duration-300">
    Print
</button>

<!-- Flowbite Script -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/flowbite/2.3.0/flowbite.min.js"></script>
<script type="text/javascript">
    const getInfo = async (port) => {
        const res = await fetch('http://localhost:' + port + '/ping', { signal: AbortSignal.timeout(5000) });
        return await res.json();
    }
    const pingServer = async () => {
        const range = {
            from: 49800,
            to: 49850,
        }

        const ports = Array.from({length: range.to - range.from + 1}, (v, i) => i + range.from);
        let port = 3001;
        window.isapi = {
            port: port,
        };

        for (let candidate of ports) {
            try {
                const res = await fetch('http://localhost:' + candidate + '/ping', { signal: AbortSignal.timeout(500) });
                if (!res.ok) {
                    continue
                }

                const info = await res.json();
                if (info.port === candidate) {
                    port = candidate;
                    window.isapi.port = port;
                    break;
                }
            } catch (e) {
                console.log(e);
            }
        }


        console.log('GOT SERVER AT PORT ' + port);
    }

    window.addEventListener('DOMContentLoaded', pingServer);

    document.getElementById('print-document').addEventListener('click', async function (event) {
        alert('Printing...');
        getInfo().then((res) => {
            console.log(res);
        }).catch((err) => {
            console.log(err);
        });

        fetch('http://localhost:' + window.isapi.port + '/print?doc=73055B86-314B-4009-982E-6D22F872D5EF').then((res) => {
            console.log(res);
        }).catch((err) => {
            console.log(err);
        });
    });
</script>
</body>
</html>
